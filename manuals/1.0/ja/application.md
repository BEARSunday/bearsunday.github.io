---
layout: docs-ja
title: アプリケーション
category: Manual
permalink: /manuals/1.0/ja/application.html
---
# アプリケーション

 <img src="/images/screen/diagram.png" style="max-width: 100%;height: auto;"/>

## 実行シーケンス
コンパイル、リクエスト、レスポンスの順でアプリケーションが実行されます。

### 0. コンパイル

`$context`に対応したDIとAOPの設定で、アプリケーションの実行に必要なルートオブジェクト`$app`を生成します。`$app`の主なプロパティは以下の通り。

* router - 外部入力をリソースリクエストに変換
* resource - リソースクライアント
* transfer - リソース状態の出力

### 1. リクエスト

`router`によってHTTPリクエストやコンソールコマンドがリソースリクエストに変更され、リソースクラインとがリエスクトを実行します。その時`onGet`などのリソースメソッドで**リソース状態**を`code`,`header`, `body`にセットします。メソッド実行の前後ではメソッドに束縛されたログや認証などのアプリケーションロジックのインタセプターががAOPで実行します。

### 2. レスポンス

リソースのレンダラーが**リソースの状態**を**表現**(JSONやHTML)にして、クライアントに**転送**します。
(**RE**presentational **S**tate **T**ransfer=REST)

## bootスクリプト

`public/`や`bin/`等のエントリーポイントに設置され、アプリケーションを全体を実行します。
スクリプトではアプリケーション実行コンテキストを指定して実行します。


```php
require dirname(__DIR__) . '/autoload.php';
exit((new Bootstrap())('app', $GLOBALS, $_SERVER));
```

デフォルトではWebサーバースクリプトです。

```bash
php -S 127.0.0.1:8080 public/index.php
```

`cli` コンテキストを付加するとコンソールアプリーケーションのスクリプトになります。

```
exit((new Bootstrap())('cli-app', $GLOBALS, $_SERVER));
```

```
php bin/app.php get /user/1
```

## コンテキスト

コンテキストは特定の目的のためのDIとAOPの束縛のセットです。コードは同じでも束縛が変わることで、アプリケーションが違う振る舞いをするようになります。上記のcliコンテキストは外部入力をhttpからコンソールに変更されました。アプリケーション、フレームワーク共にインターフェイスにのみ依存するBEAR.Sundayのクリーンな設計がこの機能を可能にしています。

フレームワークが用意しているbuilt-inコンテキストとアプリケーションが作成するカスタムコンテキストがあります。

**built-inコンテキスト**

 * `api`  APIアプリケーション
 * `cli`  コンソールアプリケーション
 * `hal`  HALフォーマット表現
 * `prod` プロダクション

 コンテキストは組み合わせて使う事ができます。

 * `app`は基本のアプリケーションです。リソースはJSONでレンダリングされます。
 * `api`はデフォルトのリソースのスキーマをpageかappに変更し、Webのルートアクセス(`GET /`)は`app://self/`へのアクセスになります。
 * `cli-app`にするとコンソールアプリケーションになります。

コンテキスト名ははそれぞれのモジュールに対応します。例えばappはAppModule, cliはCliModuleに対応します。

コンテキストの値はルートオブジェクトの作成のみに使われ、生成後は消滅します。アプリケーションから参照可能なグローバルな"モード"は存在しません。それらのモードを参照して振る舞いを変えるのではなく、**インターフェイスのみに依存**し**コンテキストによる束縛の変更**で振る舞いを変更します。
